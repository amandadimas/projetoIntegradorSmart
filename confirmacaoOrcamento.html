<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Confirmação do Orçamento</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.js"></script> <!-- html2pdf.js CDN -->
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f8fafc;
      padding: 2rem;
      text-align: center;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      background-color: #fff;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      text-align: left;
    }
    .container h2 {
      color: #1e293b;
      text-align: center;
    }
    .btn-voltar, .btn-download {
      display: inline-block;
      background-color: #1e293b;
      color: #f1f5f9;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      text-align: center;
      text-decoration: none;
      cursor: pointer;
      margin-top: 2rem;
    }
    .btn-voltar:hover, .btn-download:hover {
      background-color: #64748b;
    }
    .info-section {
      margin-bottom: 1.5rem;
    }
    .info-section h3 {
      margin-bottom: 0.5rem;
    }
    .info-item {
      margin-bottom: 0.3rem;
    }
    .info-item span {
      font-weight: bold;
    }
    .info-item span.value {
      font-weight: normal;
    }
  </style>
</head>
<body>
  <div class="container" id="orcamento-container">
    <h2>Orçamento Encaminhado com Sucesso!</h2>
    <p style="text-align: center;">Seu orçamento foi encaminhado. Em breve entraremos em contato.</p>

    <div class="info-section">
      <h3>Dados do Cliente</h3>
      <div class="info-item">
        <span>Nome:</span> <span class="value" id="cliente-nome"></span>
      </div>
      <div class="info-item">
        <span>Email:</span> <span class="value" id="cliente-email"></span>
      </div>
      <div class="info-item">
        <span>Telefone:</span> <span class="value" id="cliente-telefone"></span>
      </div>
    </div>

    <div class="info-section">
      <h3>Detalhes do Orçamento</h3>
      <div class="info-item">
        <span>Produtos:</span>
        <div class="value" id="produtos-lista"></div>
      </div>
      <div class="info-item">
        <span>Serviços:</span>
        <div class="value" id="servicos-lista"></div>
      </div>
      <div class="info-item">
        <span>Valor Total:</span> <span class="value" id="valor-total"></span>
      </div>
    </div>

    <a href="./home.html" class="btn-voltar">Voltar para a Loja</a>
    <button id="download-pdf" class="btn-download">Baixar PDF</button>
  </div>

  <script>
     // Função para ler o localStorage
  function lerLocalStorage(chave) {
    return JSON.parse(localStorage.getItem(chave));
  }

  // Função para obter detalhes de um produto por ID
  function obterDetalhesProduto(idProduto) {
    const produtos = lerLocalStorage("produtosDetalhes") ?? {};
    return produtos[idProduto] || { nome: "Produto desconhecido", preco: 0 };  // Garantir que retorne um valor padrão caso o produto não seja encontrado
  }

  // Função para preencher os dados do pedido na tela de confirmação
  function preencherDadosPedido() {
    const pedido = lerLocalStorage("pedidoAtual");

    if (pedido) {
      // Exibir dados do cliente
      document.getElementById('cliente-nome').textContent = pedido.cliente.nome || "Não informado";
      document.getElementById('cliente-email').textContent = pedido.cliente.email || "Não informado";
      document.getElementById('cliente-telefone').textContent = pedido.cliente.telefone || "Não informado";

      // Exibir produtos
      const produtosLista = document.getElementById('produtos-lista');
      produtosLista.innerHTML = ""; // Limpar lista antes de desenhar
      for (const idProduto in pedido.pedido) { 
        const quantidade = pedido.pedido[idProduto];
        const produto = obterDetalhesProduto(idProduto);
        if (produto && quantidade) {
          console.log("entrou");
          const item = document.createElement('div');
          item.textContent = `${produto.nome} (Quantidade: ${quantidade}), Preço Unitário: $${produto.preco.toFixed(2)}, Subtotal: $${(produto.preco * quantidade).toFixed(2)}`;
          produtosLista.appendChild(item);
        }
      }

      // Exibir serviços
      const servicosLista = document.getElementById('servicos-lista');
      servicosLista.innerHTML = ""; // Limpar lista antes de desenhar
      pedido.servicos.forEach(servico => {
        const item = document.createElement('div');
        item.textContent = `${servico.nome}: $${servico.preco.toFixed(2)}`;
        servicosLista.appendChild(item);
      });

      // Exibir valor total
      document.getElementById('valor-total').textContent = `Total: $${pedido.valorTotal.toFixed(2)}`;
    } else {
      alert("Erro: Pedido não encontrado.");
    }
  }

  // Função para gerar o PDF com html2pdf.js
  document.getElementById('download-pdf').addEventListener('click', function () {
    const container = document.getElementById('orcamento-container');
    
    // Ocultar os botões antes de gerar o PDF
    const botoes = document.querySelectorAll('.btn-voltar, .btn-download');
    botoes.forEach(botao => botao.style.display = 'none');

    // Configurações do html2pdf
    const opt = {
      margin:       1,
      filename:     'orcamento.pdf',
      image:        { type: 'jpeg', quality: 0.98 },
      html2canvas:  { scale: 2 },
      jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
    };

    // Gerando o PDF
    html2pdf().from(container).set(opt).save().then(() => {
      // Mostrar os botões novamente após gerar o PDF
      botoes.forEach(botao => botao.style.display = 'inline-block');
    });
  });
  
  // Inicializa a página de confirmação
  preencherDadosPedido();
  </script>
</body>
</html>                               
